<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Check if you are running an ad blocker. We recommend uBlock Origin">
    <meta name="author" content="fivefilters.org">
    <!--<link rel="icon" href="favicon.ico">-->

    <meta property="og:image" content="ff-logo.png" />

    <title>Block Ads!</title>

    <style>
    #no-blocking, #partial-blocking, #all-good { 
      display: none;
    }
    #partial-blocking p.main-warning {
			font-size: 40px;
			color: orange;
    }
    #no-blocking p.main-warning {
      font-size: 40px;
      color: red;
    }
    #all-good {
      color: lightgreen;
    }
		#all-good p { font-size: 40px; }
    </style>

    <!-- <link rel="stylesheet" href="css/ads.css"> -->

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="css/cover.css">

  </head>

  <body>

    <div class="site-wrapper">

      <div class="site-wrapper-inner">

        <div class="cover-container">

          <div class="masthead clearfix">
            <div class="inner">
              <h3 class="masthead-brand"><a href="index.html">Block Ads!</a></h3>
              <nav>
                <ul class="nav masthead-nav">
                  <li class="active"><a href="index.html">Test for ad blocker</a></li>
                  <!-- <li><a href="#">Promote ad blocking</a></li> -->
                  <li><a href="https://github.com/fivefilters/block-ads#readme">Why?</a></li>
                </ul>
              </nav>
            </div>
          </div>

          <div class="inner cover">
						<!-- Loading image -->
            <p class="lead" id="testing" style="display: none;"><img src="images/testing.gif" /></p>
            <!-- Ad blocking tests (requests for these images should be blocked by your ad blocker) -->
            <img id="test-ad" src="https://www.doubleclickbygoogle.com/static/core/img/favicons/apple-touch-icon-57x57.png" style="visibility: hidden;" />
            <img id="test-whitelist" src="https://gstatic.com/ui/v1/icons/mail/images/cleardot.gif?ads=1" style="visibility: hidden;" />
            
            <!-- Evertying okay? -->
            <div id="all-good">
							<p class="lead"><span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Ad blocking enabled!</p>
						</div>
						
					
						<!-- No ad blocking -->
            <div id="no-blocking">
              <p class="lead main-warning">No ad blocking detected</p>
              <p class="lead">We suggest you install an ad blocker</p>
              <p class="lead">
                <a href="https://github.com/gorhill/uBlock#installation" class="btn btn-lg btn-success">Get uBlock Origin</a>
              </p>
            </div>
            
						<!-- Partial blocking -->
            <div id="partial-blocking">
              <p class="lead main-warning">Only partial blocking detected</p>
              <p class="lead">We suggest you install a better ad blocker <a href="https://github.com/fivefilters/block-ads/wiki/There-are-no-acceptable-ads">(why?)</a></p>
              <p class="lead">
                <a href="https://github.com/gorhill/uBlock#installation" class="btn btn-lg btn-success">Get uBlock Origin</a>
              </p>
            </div>

          <div class="mastfoot">
            <div class="inner">
              <p>Made by <a href="http://fivefilters.org">FiveFilters.org</a> &bullet; <a href="https://github.com/fivefilters/block-ads">Fork, copy, improve</a></p>
            </div>
          </div>

        </div>

      </div>

    </div>
 
    <script src="js/jquery.min.js"></script>
    <script>
    // function to check if image has loaded, taken from http://stackoverflow.com/a/1977898
		function isImageOk(img) {
				// During the onload event, IE correctly identifies any images that
				// weren’t downloaded as not complete. Others should too. Gecko-based
				// browsers act like NS4 in that they report this incorrectly.
				if (!img.complete) {
						return false;
				}

				// However, they do have two very useful properties: naturalWidth and
				// naturalHeight. These give the true size of the image. If it failed
				// to load, either of these should be zero.
				if (typeof img.naturalWidth !== "undefined" && img.naturalWidth === 0) {
						return false;
				}
				
				// No other way of checking: assume it’s ok.
				return true;
		}    
    
    $(document).ready(function() {
			$("#testing").fadeIn('fast');
    });
    
    // runs after images have loaded (or failed to load)
		$(window).on("load", function() {
			var adLoaded = isImageOk($("img#test-ad")[0]);
			var whitelistAdLoaded = isImageOk($("img#test-whitelist")[0]);
			$("#testing").hide();
			if (!adLoaded && !whitelistAdLoaded) {
				$("#all-good").fadeIn();
			} else if (adLoaded) {
				$("#no-blocking").fadeIn();
			} else if (whitelistAdLoaded) {
				$("#partial-blocking").fadeIn();
			}
		});    
    
   
    </script>
  </body>
</html>
